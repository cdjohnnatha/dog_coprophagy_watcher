# ==============================================================================
# Dog Coprophagy Watcher - Environment Variables
# ==============================================================================
# This file contains all configurable environment variables for the dog
# coprophagy detection system. Copy this file to .env and adjust values
# as needed for your setup.

# ------------------------------------------------------------------------------
# MQTT Configuration
# ------------------------------------------------------------------------------

# MQTT broker hostname or IP address
MQTT_HOST=localhost

# MQTT broker port (default: 1883)
MQTT_PORT=1883

# MQTT username (leave empty if authentication is not required)
MQTT_USER=

# MQTT password (leave empty if authentication is not required)
MQTT_PASS=

# MQTT topic prefix for Frigate events (default: frigate)
MQTT_PREFIX=frigate

# ------------------------------------------------------------------------------
# Frigate Configuration
# ------------------------------------------------------------------------------

# Frigate base URL for internal API calls (e.g., http://frigate:5000)
FRIGATE_BASE_URL=http://frigate:5000

# Public base URL for external access (used in notifications/widgets).
# If FR_PUBLIC is set, it takes precedence over FRIGATE_PUBLIC_URL.
FRIGATE_PUBLIC_URL=http://frigate:5000

# Optional explicit public URL override (highest priority if set)
FR_PUBLIC=

# Camera name as configured in Frigate
CAMERA_NAME=dog

# Zone name where the toilet/poop area is located
TOILET_ZONE=poop_zone

# ------------------------------------------------------------------------------
# Squat Detection Parameters
# ------------------------------------------------------------------------------

# Minimum score threshold to consider the dog is in a squatting position
# Range: 0.0 to 1.0 (higher = more strict)
SQUAT_SCORE_THRESH=0.65

# Minimum duration (in seconds) the dog must maintain squat position
# before it's considered a defecation event
SQUAT_MIN_DURATION_S=5.0

# ------------------------------------------------------------------------------
# Residue Detection Parameters
# ------------------------------------------------------------------------------

# Time window (in seconds) after squat ends to confirm residue presence
RESIDUE_CONFIRM_WINDOW_S=20

# Minimum area (in pixels) for a blob to be considered as residue
RESIDUE_MIN_AREA=140

# Duration (in seconds) the residue must remain static before confirmation
RESIDUE_STATIC_SEC=2.0

# Frame rate for snapshot capture during residue detection
SNAPSHOT_FPS=4

# Interval (in seconds) between checks when monitoring for poop cleanup
CHECK_INTERVAL_S=15

# ------------------------------------------------------------------------------
# Episode Management & Deduplication
# ------------------------------------------------------------------------------

# Cooldown period (in seconds) to merge multiple detections into a single episode
# Prevents "split poop" from being counted as separate events
EP_COOLDOWN_S=180

# Timeout (in seconds) after dog leaves zone before closing the episode
LEAVE_TIMEOUT_S=8

# Maximum distance (in pixels) between centroids to consider them the same event
MERGE_RADIUS_PX=90

# ------------------------------------------------------------------------------
# Blob Shape Filters (Anti-Pee Detection)
# ------------------------------------------------------------------------------

# Minimum blob width (in pixels) to be considered valid residue
MIN_BLOB_W=14

# Minimum blob height (in pixels) to be considered valid residue
MIN_BLOB_H=14

# Minimum circularity value (4πA/P²) - filters out elongated shapes
# Range: 0.0 to 1.0 (1.0 = perfect circle)
MIN_CIRCULARITY=0.28

# Minimum solidity (area/convex_hull_area) - filters out irregular shapes
# Range: 0.0 to 1.0 (1.0 = completely solid)
MIN_SOLIDITY=0.65

# ------------------------------------------------------------------------------
# Color & Saturation Filters
# ------------------------------------------------------------------------------

# Minimum HSV saturation value for valid residue in color mode
# Wet pee puddles typically have low saturation values
HSV_S_MIN=25

# Global saturation threshold to detect monochrome/IR mode
# If mean saturation is below this, switches to B&W analysis
SAT_MONO_GLOBAL=12

# ------------------------------------------------------------------------------
# Monochrome/IR Mode Filters
# ------------------------------------------------------------------------------

# Minimum Laplacian variance (texture) in monochrome mode
# Poop has rough texture, wet puddles are smooth
TEX_MIN_MONO=25

# Maximum fraction of specular highlights (bright pixels) allowed
# Wet puddles reflect IR light creating bright spots
SPEC_MAX_MONO=0.18

# ------------------------------------------------------------------------------
# Motion & Stillness Detection
# ------------------------------------------------------------------------------

# Minimum motionless_count from Frigate to consider dog truly stationary
MOTIONLESS_MIN=3

# Maximum speed (units from Frigate) to consider dog as still
SPEED_MAX_STILL=0.15

# ------------------------------------------------------------------------------
# Debug & Logging
# ------------------------------------------------------------------------------

# Enable verbose debug logging via MQTT and console
# Accepted values: true, 1, on, yes (case-insensitive)
ENABLE_DEBUG_WATCHER=false
